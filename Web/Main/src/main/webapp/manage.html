<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>信息管理页</title>
        <link rel="icon" href="favicon.ico">
        <link href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet">
        <link href="http://cdn.bootcss.com/bootstrap-table/1.10.0/bootstrap-table.min.css" rel="stylesheet">
        <script src="http://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
        <script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
        <script src="http://cdn.bootcss.com/bootstrap-table/1.10.0/bootstrap-table.min.js"></script>
        <script src="http://cdn.bootcss.com/bootstrap-table/1.10.0/extensions/export/bootstrap-table-export.min.js"></script>
        <script src="http://cdn.bootcss.com/bootstrap-table/1.10.0/locale/bootstrap-table-zh-CN.min.js"></script>
        <script type="text/javascript">
            function operateFormatter(value, row, index) {
                return ['<a class="edit ml10" style="color:black;" href="javascript:void(0)" title="编辑">', '<span class="glyphicon glyphicon-edit"></span>', '</a>&emsp;', '<a class="remove ml10" style="color:black;" href="javascript:void(0)" title="删除">', '<i class="glyphicon glyphicon-remove"></i>', '</a>'].join('');
            }

            function hideIdFormatter(value, row, index) {
                return "<input type='hidden' value=" + value + " name='id' />";
            }


            window.operateEvents = {
                'click .edit' : function(e, value, row, index) {
                    $("#id").val($("[data-index=" + index + "]").find('td').eq(0).children().first().val());
                    $("#loginName").val($("[data-index=" + index + "]").find('td').eq(1).text());
                    $("#sex").val($("[data-index=" + index + "]").find('td').eq(2).text());
                    $("#mobileNo").val($("[data-index=" + index + "]").find('td').eq(3).text());
                    $("#email").val($("[data-index=" + index + "]").find('td').eq(5).text());
                    $("#edituc").modal("show");
                    //alert('You click edit icon, row: ' + JSON.stringify(row));
                    //console.log(value, row, index);
                },
                'click .remove' : function(e, value, row, index) {
                    //alert('You click remove icon, row: ' + JSON.stringify(row));
                    var delid = $("[data-index=" + index + "]").find('td').eq(0).children().first().val();
                    if (confirm("确定删除该条记录吗？" + delid)) {
                        $.getJSON('json/user/doDelete.do', {
                            "id" : delid
                        }, function(data) {
                            $("#dtb").bootstrapTable('refresh');
                        });
                    }
                    console.log(value, row, index);
                }
            };

            function refreshTable() {
                $("table").bootstrapTable('refresh', {
                    url : $("table").attr('data-url')
                });
            }

            function makeparmter(params) {
                params.queryby = $("#queryby").val();
                var ret = '';
                for (var i in params) {
                    ret += i + ':' + params[i];
                }
                //alert(ret);
                return params;
            }

            function saveU() {
                //alert($("#waiteduc").val());
                //alert($("#waitph").val());
                $.post('json/user/doUpdate.do', {
                    "id" : $("#id").val(),
                    "loginName" : $("#loginName").val(),
                    "sex" : $("#sex").val(),
                    "mobileNo" : $("#mobileNo").val(),
                    "email" : $("#email").val()
                }, function() {
                    alert('保存成功!');
                    $("#edituc").modal('hide');
                    $("#loginName").val('');
                    $("#sex").val('');
                    $("#mobileNo").val('');
                    $("#email").val('');
                    refreshTable();
                });
            }
        </script>
    </head>
    <body>
        <nav class="navbar navbar-inverse" role="navigation">
            <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#"></a>
                </div>

                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <p class="navbar-text">
                            后台管理
                        </p>
                    </ul>
                    <ul class="nav navbar-nav navbar-right"></ul>
                </div>
            </div>
        </nav>
        <div class="container-fluid">
            <a href="" data-toggle="modal" data-target="#myModal" id="ModalSignUp">Sign Up</a><a href="" data-toggle="modal" data-target="#myModal" id="ModalLogin">Log In</a>
            <table id="dtb" data-toggle="table" data-url="json/user/list.do"
            class="table table-hover" data-show-columns="true" data-search="true"
            data-show-refresh="true" data-show-toggle="true"
            data-show-export="true"
            data-export-types="['json', 'xml', 'csv', 'txt', 'sql', 'excel']"
            data-height="450" data-side-pagination="server"
            data-pagination="true" data-page-list="[5, 10, 20, 50, 100, 200]"
            data-query-params="makeparmter">
                <thead>
                    <tr>
                        <th data-field="id" data-formatter="hideIdFormatter" class="hide"></th>
                        <th data-field="loginName" data-align="left">姓名</th>
                        <th data-field="sex" data-align="center">性别</th>
                        <th data-field="mobileNo">手机号</th>
                        <th data-field="createTime">创建时间</th>
                        <th data-field="email">邮箱</th>
                        <th data-field="operate" data-formatter="operateFormatter"
                        data-events="operateEvents">操作</th>
                    </tr>
                </thead>
            </table>

            <div class="modal fade" id="edituc" tabindex="-1" role="dialog"
            aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal"
                            aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <h4 class="modal-title" id="myModalLabel">编辑当前用户的资料</h4>
                        </div>
                        <div class="modal-body">
                            <input id="id" type="hidden" class="form-control" value=""
                            pattern="" required="required" />
                            姓名
                            <input id="loginName" type="text" class="form-control" value=""
                            pattern="" required="required" />
                            性别
                            <input id="sex" type="text" class="form-control" value=""
                            pattern="" required="required" />
                            手机号
                            <input id="mobileNo" type="text" class="form-control" value=""
                            pattern="" required="required" />
                            邮箱
                            <input id="email" type="text" class="form-control" value=""
                            pattern="" required="required" />
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">
                                取消
                            </button>
                            <button type="button" class="btn btn-primary"
                            onclick="saveU();">
                                保存
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!--this creates a div to hold the remote content, which also is the first div tag from Bootstrap's modal code-->
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog"></div>
            <!--script to load url with the remote content-->
            <script>
                $('#ModalSignUp').click(function() {
                    $('#myModal').load('./_include-modal/signup.php');
                });
                $('#ModalLogin').click(function() {
                    $('#myModal').load('./_include-modal/login.php');
                });
            </script>
        </div>
    </body>
</html>
